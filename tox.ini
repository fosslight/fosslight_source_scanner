# Copyright (c) 2021 LG Electronics
# SPDX-License-Identifier: Apache-2.0
[tox]
envlist = test_run
skipdist = true

[testenv]
install_command = pip install {opts} {packages}
whitelist_externals = 
  cat
  rm
  ls
setenv =
  PYTHONPATH=.

[flake8]
max-line-length = 130
exclude = .tox/*

[pytest]
filterwarnings = ignore::DeprecationWarning

[testenv:test_run]
deps =
  -r{toxinidir}/requirements-dev.txt

commands =
  rm -rf test_scan
  fosslight_source -p tests/test_files -o test_scan/scan_result.csv -m
  cat test_scan/scan_result.csv

  fosslight_source -p tests/test_files -o test_scan/scan_result.csv -f csv
  cat test_scan/scan_result.csv

  fosslight_source -p tests/test_files -o test_scan/scan_result.json -f opossum
  cat test_scan/scan_result.json

  fosslight_source -p tests/test_files -o test_scan/scan_result.xlsx -f excel
  ls test_scan/scan_result.xlsx

  fosslight_source -p tests/test_files -j -o test_scan/
  ls test_scan/scancode_raw_result.json
  ls test_scan/scanoss_fingerprint.wfp
  ls test_scan/scanoss_raw_result.json

  python tests/cli_test.py

[testenv:release]
deps =
  -r{toxinidir}/requirements-dev.txt

commands =
  fosslight_source -h
  fosslight_convert -h
  fosslight_source -p tests/test_files -o test_scan/scan_result.csv -m
  cat test_scan/scan_result.csv

  fosslight_source -p tests/test_files -o test_scan/scan_result.csv -f csv
  cat test_scan/scan_result.csv

  fosslight_source -p tests/test_files -o test_scan/scan_result.json -f opossum
  cat test_scan/scan_result.json

  fosslight_source -p tests/test_files -o test_scan/scan_result.xlsx -f excel
  ls test_scan/scan_result.xlsx

  fosslight_source -p tests/test_files -j -o test_scan/
  ls test_scan/scancode_raw_result.json
  ls test_scan/scanoss_fingerprint.wfp
  ls test_scan/scanoss_raw_result.json
  python tests/cli_test.py
  pytest -v --flake8
  